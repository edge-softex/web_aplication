from django.test import SimpleTestCase
from photovoltaic.ai.lstm_forecaster import LstmForecaster
import numpy as np

class AITests(SimpleTestCase):
    def test_lstm_algorithm(self):
        irradiance = [581.6, 584.6, 596.1, 617.1, 627. , 634.9, 649.4, 696.3, 725.1, 692.7, 640.8, 617.3, 613.5, 610.8, 602.5, 591.1, 576.5, 561.4,
                  547.2, 533.8, 524.9, 516.3, 507.5, 499.2, 502.3, 510.4, 512.7,505.5, 489.6, 479.8, 475.9, 469.8, 460.3, 450.5, 449.1, 448.2,
                  444.6, 440.5, 435.6, 432.5, 437.2, 435.1, 431.9, 429.9, 428.6, 426. , 420.1, 414.5, 415.3, 412.7, 410.8, 406.2, 398.1, 382.7,
                  371.3, 368.8, 370.4, 366.5, 362.4, 360. , 360.1, 361.1, 362.6, 364.3, 365.9, 368.2, 370.4, 373. , 375. , 376.9, 378.3, 379.2,
                  379.6, 378.9, 376.9, 375.1, 373.5, 371.8, 370.6, 369.8, 371.3, 376.2, 383.6, 395.1, 411.5, 432.7, 469.2, 488.2, 500.7, 514.4,
                  522. , 527.6, 539.7, 559.1, 557. , 558.5, 571.3, 631.5, 663.8, 617.8, 586.9, 538.2, 505.7, 475.4, 454.4, 442.7, 436.7, 434.9,
                  432.9, 429.1, 429.8, 439.7, 453.9, 451.5, 455.1, 473.4, 495.1, 460. , 450.4, 459.2]
        temperature_amb = [33.65, 33.61, 33.33, 33.04, 32.92, 32.68, 32.49, 32.54, 32.59, 32.68, 32.77, 32.88, 32.92, 33.05, 33.01, 32.96, 32.84, 32.68,
                    32.39, 32.24, 32.06, 31.98, 31.87, 31.94, 31.76, 31.46, 31.17, 30.98, 30.95, 30.8 , 30.61, 30.49, 30.32, 30.21, 30.07, 29.95, 
                    29.99, 30.02, 30.02, 29.97, 29.85, 29.73, 29.37, 29.21, 29.13, 28.89, 28.72, 28.64, 28.55, 28.57, 28.48, 28.27, 28.34, 28.41,
                    28.37, 28.25, 28.08, 28.04, 28.06, 28.04, 27.97, 27.89, 27.87, 27.89, 27.91, 27.94, 27.97, 27.88, 27.76, 27.81, 27.89, 27.98,
                    27.9 , 27.95, 27.94, 27.95, 27.95, 28.09, 28.12, 27.98, 28.06, 27.84, 27.66, 27.6 , 27.45, 27.44, 27.47, 27.76, 28.04, 28.07,
                    27.89, 27.79, 27.97, 28.13, 28.45, 28.7 , 28.94, 29.23, 29.53, 29.85, 30.1 , 30.31, 30.67, 30.87, 31.  , 31.06, 31.24, 31.39,
                    31.55, 31.61, 31.61, 31.71, 31.77, 31.96, 32.02, 31.98, 32.07, 32.1 , 32.08, 32.19]

        input_data = irradiance+temperature_amb
        my_alg = LstmForecaster("lstm/model.h5")
        prediction = my_alg.compute_prediction(input_data)
        y_true = np.array([[[451.7288, 31.688929],
        [452.40866, 31.660036],
        [451.7264, 31.634079],
        [450.84164, 31.611185],
        [449.52878, 31.58948 ]]])
        y_true = y_true[0]
        
        self.assertEqual(prediction.shape, y_true.shape)
        